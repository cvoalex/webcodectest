# Monolithic Server - Request Flow Diagram

**Visual guide for understanding, maintaining, and debugging the inference pipeline**

---

## ğŸ“‹ Table of Contents

1. [High-Level Architecture](#high-level-architecture)
2. [Request Flow Overview](#request-flow-overview)
3. [Audio Processing Pipeline](#audio-processing-pipeline)
4. [Visual Processing Pipeline](#visual-processing-pipeline)
5. [Inference Pipeline](#inference-pipeline)
6. [Compositing Pipeline](#compositing-pipeline)
7. [Memory Management Flow](#memory-management-flow)
8. [Error Handling Flow](#error-handling-flow)
9. [Debugging Guide](#debugging-guide)

---

## ğŸ—ï¸ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT (gRPC Request)                           â”‚
â”‚                 CompositeBatchRequest {modelId, visual,                 â”‚
â”‚                       audio, batchSize, startFrame}                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GRPC SERVER (main.go)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Server Initialization                                           â”‚  â”‚
â”‚  â”‚  â€¢ Load config (port, models path, GPU IDs)                      â”‚  â”‚
â”‚  â”‚  â€¢ Initialize memory pools (5 types)                             â”‚  â”‚
â”‚  â”‚  â€¢ Create registries (model, image)                              â”‚  â”‚
â”‚  â”‚  â€¢ Initialize audio processor (8 STFT + 8 Mel workers)           â”‚  â”‚
â”‚  â”‚  â€¢ Create encoder pool (4 instances)                             â”‚  â”‚
â”‚  â”‚  â€¢ Start gRPC server with keepalive                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 INFERENCE SERVICE (inference.go)                        â”‚
â”‚                    InferBatchComposite()                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Validate   â”‚   Process    â”‚   Inference  â”‚   Composite      â”‚     â”‚
â”‚  â”‚   Input      â”‚   Audio+     â”‚   (GPU)      â”‚   Frames         â”‚     â”‚
â”‚  â”‚              â”‚   Visual     â”‚              â”‚   (Parallel)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  RESPONSE (CompositeBatchResponse)                      â”‚
â”‚         {success, compositedFrames[], timing metrics, error}            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Request Flow Overview

### End-to-End Timeline

```
Client Request
     â”‚
     â”œâ”€â–º [0ms] Validate Input
     â”‚        â”œâ”€ Check modelId exists
     â”‚        â”œâ”€ Verify visualFrames size (6 * 320 * 320 * 4 * batchSize)
     â”‚        â””â”€ Verify rawAudio size (16000 Hz * frames/25 * 4 bytes)
     â”‚
     â”œâ”€â–º [0-25ms] Audio Processing âš¡ PARALLEL
     â”‚        â”œâ”€ Convert bytes â†’ float32 (zero-copy)
     â”‚        â”œâ”€ STFT (8 workers, parallel windows)
     â”‚        â”œâ”€ Mel-spectrogram (8 workers, parallel)
     â”‚        â”œâ”€ Create 25fps windows (16 frames each, 50% overlap)
     â”‚        â”œâ”€ Zero-pad to match batch size
     â”‚        â””â”€ Encode features (pooled encoder)
     â”‚             Result: [batchSize, 32, 16, 16] audio features
     â”‚
     â”œâ”€â–º [25-30ms] Visual Processing
     â”‚        â”œâ”€ Parse visualFrames bytes
     â”‚        â”œâ”€ Split: first half = crops, second half = ROIs
     â”‚        â”œâ”€ Convert bytes â†’ float32 (zero-copy)
     â”‚        â””â”€ Prepare for inference
     â”‚             Result: [batchSize, 6, 320, 320] visual frames
     â”‚
     â”œâ”€â–º [30-190ms] GPU Inference ğŸš€
     â”‚        â”œâ”€ Load model from registry
     â”‚        â”œâ”€ Prepare inputs (visual + audio features)
     â”‚        â”œâ”€ Run inference on GPU
     â”‚        â””â”€ Get outputs: [batchSize, 3, 320, 320]
     â”‚
     â”œâ”€â–º [190-195ms] Parallel Compositing âš¡ GOROUTINES
     â”‚        â”œâ”€ Launch goroutine per frame
     â”‚        â”œâ”€ Convert output â†’ image (BGRâ†’RGB)
     â”‚        â”œâ”€ Resize 320x320 â†’ 1920x1080 (pooled buffers)
     â”‚        â”œâ”€ Encode JPEG (quality 95, pooled buffers)
     â”‚        â””â”€ Collect results
     â”‚             Result: [batchSize] JPEG byte arrays
     â”‚
     â””â”€â–º [195ms] Return Response
              â””â”€ CompositeBatchResponse with JPEGs + timing
```

---

## ğŸµ Audio Processing Pipeline

### Detailed Flow

```
Raw Audio Bytes (client input)
     â”‚
     â”‚ Input: []byte of float32 values (little-endian)
     â”‚ Size: batchSize * (16000/25) * 4 bytes
     â”‚       = batchSize * 640 samples * 4 bytes
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Bytes â†’ Float32 Conversion (helpers.go)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  bytesToFloat32(audioBytes []byte) []float32              â”‚ â”‚
â”‚  â”‚  â€¢ Uses unsafe.Slice for ZERO-COPY conversion            â”‚ â”‚
â”‚  â”‚  â€¢ Reinterprets byte slice as float32 slice              â”‚ â”‚
â”‚  â”‚  â€¢ No memory allocation, instant                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Output: []float32 (16kHz audio samples)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: STFT (Short-Time Fourier Transform)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  audioProcessor.ComputeSTFT(samples, 16000)               â”‚ â”‚
â”‚  â”‚  â€¢ Window size: 400 samples (25ms at 16kHz)               â”‚ â”‚
â”‚  â”‚  â€¢ Hop length: 160 samples (10ms at 16kHz)                â”‚ â”‚
â”‚  â”‚  â€¢ Hanning window applied                                 â”‚ â”‚
â”‚  â”‚  â€¢ FFT per window â†’ frequency bins                        â”‚ â”‚
â”‚  â”‚  â€¢ PARALLEL: 8 worker goroutines                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Output: [timeSteps, freqBins] complex spectrogram
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Mel-Spectrogram Conversion                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  audioProcessor.STFTToMel(stft, 16000, 80)                â”‚ â”‚
â”‚  â”‚  â€¢ Apply mel filter bank (80 mel bins)                    â”‚ â”‚
â”‚  â”‚  â€¢ Magnitude: sqrt(realÂ² + imagÂ²)                         â”‚ â”‚
â”‚  â”‚  â€¢ Power spectrum: magnitudeÂ²                             â”‚ â”‚
â”‚  â”‚  â€¢ Log scale: log(mel + 1e-5)                             â”‚ â”‚
â”‚  â”‚  â€¢ PARALLEL: 8 worker goroutines                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Output: [timeSteps, 80] mel-spectrogram
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Extract 25fps Windows (inference.go)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  For each frame at 25fps:                                 â”‚ â”‚
â”‚  â”‚    frameTime = frameIdx / 25.0  (seconds)                 â”‚ â”‚
â”‚  â”‚    centerCol = frameTime * 100  (mel-spec columns)        â”‚ â”‚
â”‚  â”‚    Extract window: [centerCol-8 : centerCol+8]            â”‚ â”‚
â”‚  â”‚                    = 16 columns centered on frame         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Window structure (16 frames, 50% overlap):               â”‚ â”‚
â”‚  â”‚    Frame 0: columns [0:16]   â”€â”                           â”‚ â”‚
â”‚  â”‚    Frame 1: columns [1:17]    â”œâ”€ 50% overlap (8 columns)  â”‚ â”‚
â”‚  â”‚    Frame 2: columns [2:18]   â”€â”˜                           â”‚ â”‚
â”‚  â”‚    ...                                                     â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Use POOLED mel window buffer (avoid allocation)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Output: [numWindows, 80, 16] mel windows
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: Zero-Padding (if needed)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  If numWindows < batchSize:                               â”‚ â”‚
â”‚  â”‚    padLeft = (batchSize - numWindows) / 2                 â”‚ â”‚
â”‚  â”‚    padRight = batchSize - numWindows - padLeft            â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚    Result = [padLeft zeros] + [mel windows] + [padRight]  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Example (3 windows â†’ batch 8):                           â”‚ â”‚
â”‚  â”‚    padLeft = 2, padRight = 3                              â”‚ â”‚
â”‚  â”‚    [0, 0, W1, W2, W3, 0, 0, 0]                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Output: [batchSize, 80, 16] padded mel windows
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: Audio Encoding (pooled encoder)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  encoderPool.Get() â†’ audio encoder instance               â”‚ â”‚
â”‚  â”‚  encoder.Run(melWindows) â†’ audio features                 â”‚ â”‚
â”‚  â”‚  encoderPool.Put(encoder) â†’ return to pool                â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Pool: 4 encoder instances (avoid loading overhead)       â”‚ â”‚
â”‚  â”‚  Output shape: [batchSize, 32, 16, 16]                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Output: [batchSize, 32, 16, 16] audio features
     â–¼
Ready for Inference (combined with visual frames)
```

### Audio Processing Key Points

| Aspect | Details |
|--------|---------|
| **Input** | Raw audio bytes (16kHz, float32) |
| **STFT** | 8 parallel workers, 400-sample windows, 160-sample hop |
| **Mel** | 80 mel bins, 8 parallel workers, log scale |
| **Windows** | 16 frames per window, 50% overlap, 25fps timing |
| **Padding** | Center alignment with zeros if needed |
| **Encoder** | Pooled (4 instances), outputs [32, 16, 16] |
| **Time** | ~23ms total (parallel processing) |

---

## ğŸ‘ï¸ Visual Processing Pipeline

### Detailed Flow

```
Visual Frames Bytes (client input)
     â”‚
     â”‚ Input: Flattened byte array
     â”‚ Layout: [all crops] + [all ROIs]
     â”‚ Size: batchSize * 2 * (3 * 320 * 320 * 4) bytes
     â”‚       = batchSize * 6 channels * 320 * 320 * 4 bytes
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Parse Visual Frames (inference.go)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Expected size = batchSize * 6 * 320 * 320 * 4            â”‚ â”‚
â”‚  â”‚               = batchSize * 1,228,800 bytes/frame          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Layout:                                                   â”‚ â”‚
â”‚  â”‚    Bytes [0 : halfSize]           = All crop faces        â”‚ â”‚
â”‚  â”‚    Bytes [halfSize : fullSize]    = All ROIs              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Where:                                                    â”‚ â”‚
â”‚  â”‚    cropSize = 3 * 320 * 320 * 4 = 1,228,800 bytes        â”‚ â”‚
â”‚  â”‚    halfSize = batchSize * cropSize                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º Crops:  visualFrames[0 : halfSize]
     â”‚           â”œâ”€ Frame 0 crop: [0:1228800]
     â”‚           â”œâ”€ Frame 1 crop: [1228800:2457600]
     â”‚           â””â”€ ... (all batch frames)
     â”‚
     â””â”€â–º ROIs:   visualFrames[halfSize : end]
                 â”œâ”€ Frame 0 ROI: [halfSize:halfSize+1228800]
                 â”œâ”€ Frame 1 ROI: [halfSize+1228800:...]
                 â””â”€ ... (all batch frames)
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Combine Crops + ROIs (inference.go)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  For each frame:                                           â”‚ â”‚
â”‚  â”‚    visualFrame = [crop (3 ch), ROI (3 ch)]                â”‚ â”‚
â”‚  â”‚                = 6 channels total                          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Structure per frame:                                      â”‚ â”‚
â”‚  â”‚    Channel 0: Crop R (320x320)                            â”‚ â”‚
â”‚  â”‚    Channel 1: Crop G (320x320)                            â”‚ â”‚
â”‚  â”‚    Channel 2: Crop B (320x320)                            â”‚ â”‚
â”‚  â”‚    Channel 3: ROI R (320x320)                             â”‚ â”‚
â”‚  â”‚    Channel 4: ROI G (320x320)                             â”‚ â”‚
â”‚  â”‚    Channel 5: ROI B (320x320)                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Output: [batchSize, 6, 320, 320] float32 tensor
     â–¼
Ready for Inference (combined with audio features)
```

### Visual Frame Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Single Visual Frame (6 channels, 320x320)                   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  CROP FACE (3 ch)  â”‚  â”‚  ROI (3 ch)        â”‚             â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚
â”‚  â”‚  â”‚     R        â”‚  â”‚  â”‚  â”‚     R        â”‚  â”‚             â”‚
â”‚  â”‚  â”‚   320x320    â”‚  â”‚  â”‚  â”‚   320x320    â”‚  â”‚             â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚
â”‚  â”‚  â”‚     G        â”‚  â”‚  â”‚  â”‚     G        â”‚  â”‚             â”‚
â”‚  â”‚  â”‚   320x320    â”‚  â”‚  â”‚  â”‚   320x320    â”‚  â”‚             â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚
â”‚  â”‚  â”‚     B        â”‚  â”‚  â”‚  â”‚     B        â”‚  â”‚             â”‚
â”‚  â”‚  â”‚   320x320    â”‚  â”‚  â”‚  â”‚   320x320    â”‚  â”‚             â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                              â”‚
â”‚  Purpose:                                                    â”‚
â”‚  â€¢ Crop: Detected face region (tight crop)                  â”‚
â”‚  â€¢ ROI: Region of Interest (context around face)            â”‚
â”‚  â€¢ Model uses both for better lip-sync synthesis            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§  Inference Pipeline

### Model Execution Flow

```
Inputs Ready
     â”‚
     â”œâ”€â–º Visual: [batchSize, 6, 320, 320] float32
     â””â”€â–º Audio:  [batchSize, 32, 16, 16] float32
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Load Model (model_management.go)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  modelRegistry.GetModel(modelId)                          â”‚ â”‚
â”‚  â”‚  â€¢ Check if model loaded in registry                      â”‚ â”‚
â”‚  â”‚  â€¢ If not found, return error                             â”‚ â”‚
â”‚  â”‚  â€¢ Model already on GPU (loaded at startup)               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Model handle retrieved
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Prepare Input Tensors (inference.go)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Input tensor map:                                         â”‚ â”‚
â”‚  â”‚    "visual_frames" â†’ [batchSize, 6, 320, 320]             â”‚ â”‚
â”‚  â”‚    "audio_features" â†’ [batchSize, 32, 16, 16]             â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Tensors already in correct format (float32)              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Inputs prepared
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: GPU Inference (ONNX Runtime)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  model.Run(inputs)                                         â”‚ â”‚
â”‚  â”‚  â€¢ Execute on GPU (CUDA)                                   â”‚ â”‚
â”‚  â”‚  â€¢ Neural network forward pass                            â”‚ â”‚
â”‚  â”‚  â€¢ SyncTalk model architecture:                           â”‚ â”‚
â”‚  â”‚    - Visual encoder                                        â”‚ â”‚
â”‚  â”‚    - Audio encoder (already encoded)                      â”‚ â”‚
â”‚  â”‚    - Cross-modal fusion                                   â”‚ â”‚
â”‚  â”‚    - Decoder (generates lip-synced frames)                â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Time: ~165ms for batch 8                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Outputs generated
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Extract Outputs (inference.go)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Output tensor: [batchSize, 3, 320, 320]                  â”‚ â”‚
â”‚  â”‚  â€¢ 3 channels: RGB                                         â”‚ â”‚
â”‚  â”‚  â€¢ 320x320: Output resolution                             â”‚ â”‚
â”‚  â”‚  â€¢ float32 values [0, 255] range                          â”‚ â”‚
â”‚  â”‚  â€¢ Each frame is lip-synced result                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Output: [batchSize, 3, 320, 320] float32
     â–¼
Ready for Compositing (convert to JPEGs)
```

### Inference Key Points

| Aspect | Details |
|--------|---------|
| **Model Type** | ONNX (SyncTalk 2D lip-sync model) |
| **Runtime** | ONNX Runtime with CUDA provider |
| **GPU** | RTX 4090 (dev), RTX 6000 Blackwell Pro (prod) |
| **Batch Size** | 8 frames (default), up to 25 frames |
| **Input 1** | Visual frames [batch, 6, 320, 320] |
| **Input 2** | Audio features [batch, 32, 16, 16] |
| **Output** | RGB frames [batch, 3, 320, 320] |
| **Time** | ~165ms for batch 8 |

---

## ğŸ¨ Compositing Pipeline

### Parallel Frame Processing

```
Inference Outputs: [batchSize, 3, 320, 320]
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Launch Parallel Goroutines (1 per frame)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  for i := 0; i < batchSize; i++ {                         â”‚ â”‚
â”‚  â”‚      go compositeFrame(outputTensor[i], i, resultChan)    â”‚ â”‚
â”‚  â”‚  }                                                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Each goroutine processes independently:                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º Goroutine 1: Frame 0 â”€â”€â”
     â”œâ”€â–º Goroutine 2: Frame 1   â”œâ”€â–º All run in PARALLEL
     â”œâ”€â–º Goroutine 3: Frame 2   â”‚
     â””â”€â–º ... (all frames)      â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Convert Output to Image (helpers.go)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  outputToImage(tensor [3, 320, 320]) â†’ *image.RGBA        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  For each pixel (x, y):                                    â”‚ â”‚
â”‚  â”‚    R = clamp(tensor[0][y][x], 0, 255)                     â”‚ â”‚
â”‚  â”‚    G = clamp(tensor[1][y][x], 0, 255)                     â”‚ â”‚
â”‚  â”‚    B = clamp(tensor[2][y][x], 0, 255)                     â”‚ â”‚
â”‚  â”‚    A = 255 (fully opaque)                                  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  NOTE: Tensor is BGR order, swap to RGB:                  â”‚ â”‚
â”‚  â”‚    img[R] = tensor[2]  (Bâ†’R swap)                         â”‚ â”‚
â”‚  â”‚    img[G] = tensor[1]  (Gâ†’G)                              â”‚ â”‚
â”‚  â”‚    img[B] = tensor[0]  (Râ†’B swap)                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Output: *image.RGBA (320x320)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Resize to Full HD (helpers.go)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  resizeImagePooled(img, 1920, 1080) â†’ *image.RGBA         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â€¢ Get pooled RGBA image (1920x1080) - ZERO ALLOCATION   â”‚ â”‚
â”‚  â”‚  â€¢ Bilinear interpolation for smooth scaling              â”‚ â”‚
â”‚  â”‚  â€¢ For each output pixel:                                 â”‚ â”‚
â”‚  â”‚      - Calculate source position (float)                  â”‚ â”‚
â”‚  â”‚      - Get 4 neighboring pixels                           â”‚ â”‚
â”‚  â”‚      - Interpolate color values                           â”‚ â”‚
â”‚  â”‚  â€¢ Return pooled buffer after use                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Output: *image.RGBA (1920x1080)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Encode to JPEG (helpers.go)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Get pooled buffer from bufferPool                        â”‚ â”‚
â”‚  â”‚  jpeg.Encode(buffer, img, quality: 95)                    â”‚ â”‚
â”‚  â”‚  â€¢ Quality 95: High quality, reasonable size              â”‚ â”‚
â”‚  â”‚  â€¢ Progressive encoding: Off                              â”‚ â”‚
â”‚  â”‚  â€¢ Typical size: ~50-100KB per frame                      â”‚ â”‚
â”‚  â”‚  Return pooled buffer after copying bytes                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Output: []byte (JPEG compressed)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Send to Result Channel                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  resultChan <- FrameResult{                                â”‚ â”‚
â”‚  â”‚      Index:      frameIdx,                                 â”‚ â”‚
â”‚  â”‚      JPEGBytes:  jpegData,                                 â”‚ â”‚
â”‚  â”‚      Error:      nil,                                      â”‚ â”‚
â”‚  â”‚  }                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Collect All Results (inference.go)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  for i := 0; i < batchSize; i++ {                         â”‚ â”‚
â”‚  â”‚      result := <-resultChan                                â”‚ â”‚
â”‚  â”‚      compositedFrames[result.Index] = result.JPEGBytes    â”‚ â”‚
â”‚  â”‚  }                                                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Wait for ALL goroutines to complete                      â”‚ â”‚
â”‚  â”‚  Results collected in correct order (by index)            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Output: [][]byte (JPEG frames in order)
     â–¼
Return to Client
```

### Compositing Flow Diagram

```
    Inference Output
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
         â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚
        F0     F1     F2     F3     F4     F5     F6     F7
         â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚
         â”œâ”€â”€â”€â”€â”€â†’â”œâ”€â”€â”€â”€â”€â†’â”œâ”€â”€â”€â”€â”€â†’â”œâ”€â”€â”€â”€â”€â†’â”œâ”€â”€â”€â”€â”€â†’â”œâ”€â”€â”€â”€â”€â†’â”œâ”€â”€â”€â”€â”€â†’â”œâ”€â”€â†’ PARALLEL
         â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â” â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚
    â”‚BGRâ†’RGB â”‚ â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚
    â”‚Converterâ”‚ â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚
         â”‚  â”Œâ”€â”€â–¼â”€â”€â”€â”  â”‚      â”‚      â”‚      â”‚      â”‚      â”‚
         â”‚  â”‚BGRâ†’RGBâ”‚ â”‚      â”‚      â”‚      â”‚      â”‚      â”‚
         â”‚  â””â”€â”€â”¬â”€â”€â”€â”˜  â”‚      â”‚      â”‚      â”‚      â”‚      â”‚
         â”‚     â”‚  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”‚      â”‚      â”‚      â”‚      â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”â”‚  â”‚BGRâ†’RGBâ”‚ â”‚      â”‚      â”‚      â”‚      â”‚
    â”‚ Resize  â”‚â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â”‚      â”‚      â”‚      â”‚      â”‚
    â”‚320â†’1920 â”‚â”‚      â”‚  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”‚      â”‚      â”‚      â”‚
    â”‚320â†’1080 â”‚â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”â”‚BRâ†’RGBâ”‚ â”‚      â”‚      â”‚      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚ â”‚ Resize  â”‚â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â”‚      â”‚      â”‚      â”‚
         â”‚     â”‚ â”‚320â†’1920 â”‚    â”‚ â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”‚      â”‚      â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â” â”‚ â”‚320â†’1080 â”‚â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”Râ†’RGBâ”‚ â”‚      â”‚      â”‚
    â”‚  JPEG  â”‚ â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚ Resize â”‚â”¬â”€â”€â”€â”˜  â”‚      â”‚      â”‚
    â”‚Encoder â”‚ â”‚      â”‚     â”‚320â†’1920â”‚â”‚  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”‚      â”‚
    â”‚Quality â”‚ â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â” â”‚320â†’1080â”‚â”‚  â”‚BRâ†’RGB â”‚  â”‚      â”‚
    â”‚  95    â”‚ â”‚ â”‚  JPEG  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â”‚      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â”‚ â”‚Encoder â”‚      â”‚ â”Œâ”€â”€â–¼â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”‚
         â”‚     â”‚ â”‚Quality â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”esize â”‚ â”‚  â”‚BRâ†’RGB â”‚  â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â” â”‚ â”‚  95    â”‚ â”‚  JPEG  â”‚20â†’1920â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â”‚
    â”‚ Result â”‚ â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â”‚Encoder â”‚20â†’1080â”‚  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”‚
    â”‚Channel â”‚ â”‚      â”‚     â”‚Quality â”‚â”€â”€â”€â”¬â”€â”€â”€â”˜  â”‚ Resize â”‚  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â” â”‚  95    â”‚   â”‚  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
               â”‚ â”‚ Result â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜   â”‚  â”‚20â†’1920     â”‚  â”‚
               â”‚ â”‚Channel â”‚      â”‚   â”Œâ”€â”€â”€â–¼â”€â”€â–¼â”€20â†’1080    â”‚  â”‚
               â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â” Result â”‚â”€â”€â”€â”¬â”€â”€â”€â”   â”‚  â”‚
               â”‚            â”‚ Result â”‚Channel â”‚PEG â”‚   â”‚   â”‚  â”‚
               â”‚            â”‚Channel â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”˜coder   â”‚   â”‚  â”‚
               â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       Quality   â”‚   â”‚  â”‚
               â”‚                               95 â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
               â”‚                          â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”       â”‚  â”‚
               â”‚                          â”‚sult    â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â–¼â”€â”
               â”‚                          â”‚annel   â”‚  â”‚ JPEG    â”‚
               â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚Encoder  â”‚
               â”‚                                      â”‚Quality  â”‚
               â”‚                                      â”‚  95     â”‚
               â”‚                                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
               â”‚                                           â”‚
               â”‚                                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
               â”‚                                      â”‚ Result  â”‚
               â”‚                                      â”‚Channel  â”‚
               â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    Collect All Results (ordered by index)
```

### Compositing Key Points

| Aspect | Details |
|--------|---------|
| **Parallelism** | 1 goroutine per frame (all parallel) |
| **Color Conv** | BGRâ†’RGB swap during conversion |
| **Resize** | 320x320 â†’ 1920x1080 (6x scale, bilinear) |
| **JPEG Quality** | 95 (high quality, ~50-100KB per frame) |
| **Memory Pools** | Pooled RGBA images, pooled buffers |
| **Time** | ~4ms total (parallel execution) |
| **Output** | Array of JPEG byte slices (ordered) |

---

## ğŸ’¾ Memory Management Flow

### Pool Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MEMORY POOLS (constants.go)                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. bufferPool (bytes.Buffer pool)                      â”‚   â”‚
â”‚  â”‚     â€¢ Purpose: JPEG encoding buffers                    â”‚   â”‚
â”‚  â”‚     â€¢ Reuse: Get() â†’ Encode â†’ Put()                     â”‚   â”‚
â”‚  â”‚     â€¢ Avoids: Repeated allocations for encoding         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. rgbaPool320 (image.RGBA pool, 320x320)             â”‚   â”‚
â”‚  â”‚     â€¢ Purpose: Store inference outputs                  â”‚   â”‚
â”‚  â”‚     â€¢ Reuse: Get() â†’ Fill â†’ Convert â†’ Put()            â”‚   â”‚
â”‚  â”‚     â€¢ Avoids: Allocating new 320x320 images            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. rgbaPoolFullHD (image.RGBA pool, 1920x1080)        â”‚   â”‚
â”‚  â”‚     â€¢ Purpose: Resized output frames                    â”‚   â”‚
â”‚  â”‚     â€¢ Reuse: Get() â†’ Resize into â†’ Encode â†’ Put()      â”‚   â”‚
â”‚  â”‚     â€¢ Avoids: Allocating large 1920x1080 images        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  4. rgbaPoolResize (image.RGBA pool, variable sizes)   â”‚   â”‚
â”‚  â”‚     â€¢ Purpose: Temporary resize operations              â”‚   â”‚
â”‚  â”‚     â€¢ Reuse: Get(width, height) â†’ Use â†’ Put()          â”‚   â”‚
â”‚  â”‚     â€¢ Avoids: Allocations for intermediate resizes     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  5. melWindowPool (float32 slice pool, 80x16)          â”‚   â”‚
â”‚  â”‚     â€¢ Purpose: Mel-spectrogram window extraction        â”‚   â”‚
â”‚  â”‚     â€¢ Reuse: Get() â†’ Fill window â†’ Encode â†’ Put()      â”‚   â”‚
â”‚  â”‚     â€¢ Avoids: Allocating mel windows per frame         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Pool Lifecycle Example: Compositing a Frame

```
START
  â”‚
  â”œâ”€â–º Get pooled 320x320 RGBA image
  â”‚   rgbaPool320.Get() â†’ img320
  â”‚   â””â”€â–º Fill with inference output (BGRâ†’RGB)
  â”‚
  â”œâ”€â–º Get pooled 1920x1080 RGBA image
  â”‚   rgbaPoolFullHD.Get() â†’ imgFullHD
  â”‚   â””â”€â–º Resize img320 into imgFullHD (bilinear)
  â”‚
  â”œâ”€â–º Get pooled buffer
  â”‚   bufferPool.Get() â†’ buffer
  â”‚   â””â”€â–º Encode imgFullHD to JPEG into buffer
  â”‚
  â”œâ”€â–º Copy JPEG bytes out
  â”‚   jpegBytes := buffer.Bytes()
  â”‚
  â”œâ”€â–º Return all to pools
  â”‚   rgbaPool320.Put(img320)
  â”‚   rgbaPoolFullHD.Put(imgFullHD)
  â”‚   bufferPool.Put(buffer)
  â”‚
END
  â””â”€â–º Memory reused for next frame (ZERO GC pressure)
```

### Memory Savings

| Operation | Without Pools | With Pools | Savings |
|-----------|--------------|------------|---------|
| **320x320 RGBA** | 409,600 bytes Ã— batch | Reused | ~3.2MB saved (batch 8) |
| **1920x1080 RGBA** | 8,294,400 bytes Ã— batch | Reused | ~66MB saved (batch 8) |
| **JPEG buffers** | ~100KB Ã— batch | Reused | ~800KB saved (batch 8) |
| **Mel windows** | 5,120 bytes Ã— batch | Reused | ~40KB saved (batch 8) |
| **Total saved** | - | - | **~70MB per request** |

---

## âš ï¸ Error Handling Flow

### Validation & Error Paths

```
Request Received
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Input Validation (inference.go)                           â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ Model ID Check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  if modelId == "" {                                   â”‚  â”‚
â”‚  â”‚    return Error: "modelId cannot be empty"            â”‚  â”‚
â”‚  â”‚  }                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ Model Exists Check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  model := registry.GetModel(modelId)                  â”‚  â”‚
â”‚  â”‚  if model == nil {                                     â”‚  â”‚
â”‚  â”‚    return Error: "model not found: {modelId}"         â”‚  â”‚
â”‚  â”‚  }                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ Visual Frames Size Check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  expectedSize = batchSize * 6 * 320 * 320 * 4         â”‚  â”‚
â”‚  â”‚  if len(visualFrames) != expectedSize {                â”‚  â”‚
â”‚  â”‚    return Error: "visual frames size mismatch"        â”‚  â”‚
â”‚  â”‚    Details: got {len}, expected {expectedSize}        â”‚  â”‚
â”‚  â”‚  }                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ Audio Size Check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  if len(rawAudio) == 0 {                               â”‚  â”‚
â”‚  â”‚    return Error: "audio cannot be empty"              â”‚  â”‚
â”‚  â”‚  }                                                     â”‚  â”‚
â”‚  â”‚  expectedSamples = batchSize * (16000 / 25)           â”‚  â”‚
â”‚  â”‚  if len(rawAudio)/4 != expectedSamples {               â”‚  â”‚
â”‚  â”‚    return Error: "audio size mismatch"                â”‚  â”‚
â”‚  â”‚  }                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ âœ… Validation passed
     â–¼
Processing...
     â”‚
     â”œâ”€â–º Audio Processing Error?
     â”‚   â”œâ”€ STFT failed â†’ return Error + log details
     â”‚   â””â”€ Mel conversion failed â†’ return Error + log details
     â”‚
     â”œâ”€â–º Inference Error?
     â”‚   â”œâ”€ Model.Run() failed â†’ return Error + stack trace
     â”‚   â””â”€ Output shape wrong â†’ return Error + details
     â”‚
     â””â”€â–º Compositing Error?
         â”œâ”€ JPEG encoding failed â†’ return Error for that frame
         â””â”€ Channel timeout â†’ return Error + partial results
     â”‚
     â–¼
Error Response
     â”‚
     â””â”€â–º CompositeBatchResponse {
           Success: false,
           Error: "detailed error message",
           CompositedFrames: [] (empty),
         }
```

### Error Categories

| Category | Example | Response |
|----------|---------|----------|
| **Validation** | Invalid input sizes | HTTP 400, clear error message |
| **Model** | Model not found | HTTP 404, model ID in error |
| **Processing** | Audio processing failed | HTTP 500, processing stage in error |
| **Inference** | GPU out of memory | HTTP 500, CUDA error details |
| **Compositing** | JPEG encoding failed | HTTP 500, frame index in error |

---

## ğŸ› Debugging Guide

### Debug File Locations

When debug file saving is enabled (check code for debug flags):

```
test_output/
â”œâ”€â”€ mel_spec_{timestamp}.npy           â† Mel-spectrogram (before encoding)
â”œâ”€â”€ audio_features_{timestamp}.npy     â† Audio features (after encoding)
â”œâ”€â”€ visual_input_{timestamp}.npy       â† Visual frames input
â”œâ”€â”€ inference_output_{timestamp}.npy   â† Raw inference output
â””â”€â”€ frame_{idx}_{timestamp}.jpg        â† Individual composited frames
```

### Performance Profiling Points

```go
// Key timing points to measure:

1. Audio Processing:
   start := time.Now()
   // STFT + Mel + Windowing + Encoding
   audioTime := time.Since(start)
   
2. Inference:
   start := time.Now()
   outputs := model.Run(inputs)
   inferTime := time.Since(start)
   
3. Compositing:
   start := time.Now()
   // Parallel compositing of all frames
   compositeTime := time.Since(start)
   
4. Total:
   totalTime := audioTime + inferTime + compositeTime
```

### Common Issues & Solutions

| Issue | Symptoms | Debug Steps | Solution |
|-------|----------|-------------|----------|
| **Slow audio processing** | >30ms audio time | Check worker count, profile STFT/Mel | Increase workers (default: 8 each) |
| **Slow inference** | >200ms infer time | Check GPU utilization, batch size | Optimize batch size, check GPU memory |
| **Slow compositing** | >10ms composite time | Check goroutine count, JPEG quality | Reduce quality or increase pool sizes |
| **High memory** | >100MB per request | Check pool returns, look for leaks | Ensure all `Put()` calls happen |
| **Wrong output** | Visual artifacts | Save debug files, check input shapes | Verify BGRâ†’RGB, check normalization |
| **Audio desync** | Lips don't match | Check 25fps windowing, padding | Verify mel window extraction logic |

### Logging Best Practices

```go
// Current logging pattern (buffered logger):

logger.Info("Starting inference",
    "modelId", modelId,
    "batchSize", batchSize,
    "startFrame", startFrameIdx)

// Add timing logs:
logger.Debug("Audio processing complete",
    "duration_ms", audioTime.Milliseconds(),
    "mel_shape", melShape)

logger.Debug("Inference complete",
    "duration_ms", inferTime.Milliseconds(),
    "output_shape", outputShape)

logger.Debug("Compositing complete",
    "duration_ms", compositeTime.Milliseconds(),
    "frames", len(compositedFrames))
```

### Profiling Commands

```bash
# CPU profiling
go test -cpuprofile=cpu.prof -bench=.
go tool pprof cpu.prof

# Memory profiling
go test -memprofile=mem.prof -bench=.
go tool pprof mem.prof

# Trace execution
go test -trace=trace.out -bench=.
go tool trace trace.out

# Run with race detector
go run -race cmd/server/main.go
```

---

## ğŸ“Š Summary Cheat Sheet

### Request Processing Pipeline

| Stage | Time | Parallelism | Key Files |
|-------|------|-------------|-----------|
| **Validation** | <1ms | Serial | `inference.go` |
| **Audio** | ~23ms | 8+8 workers | `inference.go` + audio processor |
| **Visual** | ~2ms | Serial | `inference.go` |
| **Inference** | ~165ms | GPU batch | `inference.go` + model |
| **Compositing** | ~4ms | Per-frame | `helpers.go` + goroutines |
| **TOTAL** | ~195ms | Mixed | All files |

### Memory Pools Quick Reference

| Pool | Size | Purpose | File |
|------|------|---------|------|
| `bufferPool` | Variable | JPEG buffers | `constants.go` |
| `rgbaPool320` | 320Ã—320 | Inference outputs | `constants.go` |
| `rgbaPoolFullHD` | 1920Ã—1080 | Resized frames | `constants.go` |
| `rgbaPoolResize` | Variable | Temp resizes | `constants.go` |
| `melWindowPool` | 80Ã—16 | Mel windows | `constants.go` |

### Key Constants

| Constant | Value | Purpose | File |
|----------|-------|---------|------|
| `visualFrameSize` | 6Ã—320Ã—320 | 6-channel visual input | `constants.go` |
| `audioFrameSize` | 32Ã—16Ã—16 | Audio feature dims | `constants.go` |
| `outputFrameSize` | 3Ã—320Ã—320 | RGB output dims | `constants.go` |
| Mel bins | 80 | Frequency resolution | Audio processor |
| Mel window | 16 frames | Temporal context | `inference.go` |
| Sample rate | 16000 Hz | Audio frequency | Audio processor |
| FPS | 25 | Video frame rate | `inference.go` |

---

**Last Updated:** October 28, 2025  
**Purpose:** Maintenance, debugging, and onboarding reference  
**Status:** Complete and validated
